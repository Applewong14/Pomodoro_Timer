<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B4BC8'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0; }
        }
        .pulse-ring {
            animation: pulse-ring 2s infinite;
        }
        
        .timer-circle {
            transition: stroke-dashoffset 0.1s linear;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">üçÖ Pomodoro Timer</h1>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Stay focused and productive</p>
            
            <!-- Date and Time Display -->
            <div class="inline-block bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl px-6 py-4 shadow-sm">
                <div id="currentDateTime" class="text-lg font-medium text-gray-700 dark:text-gray-300"></div>
                <div id="currentWeekday" class="text-sm text-gray-500 dark:text-gray-400 mt-1"></div>
            </div>
        </div>

        <!-- Timer Card -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-8 shadow-lg mb-6">
            <!-- Phase Display -->
            <div class="text-center mb-6">
                <div id="phaseIndicator" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-primary text-white mb-2">
                    <span id="phaseIcon">üíº</span>
                    <span id="phaseText" class="ml-2">Work Time</span>
                </div>
                <div id="sessionCounter" class="text-gray-600 dark:text-gray-400 text-sm">
                    Session 1 of 4
                </div>
            </div>

            <!-- Timer Circle -->
            <div class="relative flex items-center justify-center mb-6">
                <svg class="w-64 h-64 transform -rotate-90" viewBox="0 0 100 100">
                    <!-- Background circle -->
                    <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="2" fill="none" class="text-gray-200 dark:text-gray-700"/>
                    <!-- Progress circle -->
                    <circle id="progressCircle" cx="50" cy="50" r="45" stroke="currentColor" stroke-width="4" fill="none" 
                            class="text-primary timer-circle" stroke-linecap="round"
                            stroke-dasharray="283" stroke-dashoffset="283"/>
                </svg>
                
                <!-- Timer Display -->
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                        <div id="timeDisplay" class="text-5xl font-mono font-bold">25:00</div>
                        <div id="phaseLabel" class="text-sm text-gray-600 dark:text-gray-400 mt-1">Focus Time</div>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="flex justify-center space-x-4 mb-6">
                <button id="startPauseBtn" class="px-8 py-3 bg-primary hover:bg-primary-dark text-white rounded-xl font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                    Start
                </button>
                <button id="resetBtn" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                    Reset
                </button>
                <button id="skipBtn" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                    Skip
                </button>
            </div>

            <!-- Sound Toggle -->
            <div class="flex justify-center mb-6">
                <button id="soundToggleBtn" class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                    <span id="soundIcon">üîä</span>
                    <span id="soundText" class="ml-2">Sound On</span>
                </button>
            </div>



            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div id="sessionProgress" class="bg-primary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
            <h3 class="text-lg font-semibold mb-4">Settings</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Work Duration</label>
                    <input id="workDuration" type="number" min="1" max="60" value="25" 
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:outline-none focus:ring-2 focus:ring-primary">
                    <span class="text-xs text-gray-500">minutes</span>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Short Break</label>
                    <input id="shortBreakDuration" type="number" min="1" max="30" value="5" 
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:outline-none focus:ring-2 focus:ring-primary">
                    <span class="text-xs text-gray-500">minutes</span>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Long Break</label>
                    <input id="longBreakDuration" type="number" min="1" max="60" value="15" 
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:outline-none focus:ring-2 focus:ring-primary">
                    <span class="text-xs text-gray-500">minutes</span>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="mt-6 grid grid-cols-2 gap-4">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4 text-center">
                <div id="completedSessions" class="text-2xl font-bold text-primary">0</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Sessions Today</div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4 text-center">
                <div id="totalTime" class="text-2xl font-bold text-primary">0h 0m</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Focus Time</div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        class PomodoroTimer {
            constructor() {
                this.isRunning = false;
                this.currentSession = 1;
                this.currentPhase = 'work'; // 'work', 'shortBreak', 'longBreak'
                this.timeLeft = 25 * 60; // 25 minutes in seconds
                this.initialTime = 25 * 60;
                this.completedSessions = 0;
                this.totalFocusTime = 0;
                this.timer = null;
                this.soundEnabled = true;

                this.bindElements();
                this.bindEvents();
                this.updateDisplay();
                this.updateProgress();
                this.updateDateTime();
                this.startDateTimeUpdater();
            }

            bindElements() {
                this.timeDisplay = document.getElementById('timeDisplay');
                this.phaseText = document.getElementById('phaseText');
                this.phaseIcon = document.getElementById('phaseIcon');
                this.phaseLabel = document.getElementById('phaseLabel');
                this.sessionCounter = document.getElementById('sessionCounter');
                this.startPauseBtn = document.getElementById('startPauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.skipBtn = document.getElementById('skipBtn');
                this.progressCircle = document.getElementById('progressCircle');
                this.sessionProgress = document.getElementById('sessionProgress');
                this.workDurationInput = document.getElementById('workDuration');
                this.shortBreakInput = document.getElementById('shortBreakDuration');
                this.longBreakInput = document.getElementById('longBreakDuration');
                this.completedSessionsEl = document.getElementById('completedSessions');
                this.totalTimeEl = document.getElementById('totalTime');
                
                // Date and time elements
                this.currentDateTimeEl = document.getElementById('currentDateTime');
                this.currentWeekdayEl = document.getElementById('currentWeekday');
                
                // Sound toggle elements
                this.soundToggleBtn = document.getElementById('soundToggleBtn');
                this.soundIcon = document.getElementById('soundIcon');
                this.soundText = document.getElementById('soundText');
            }

            bindEvents() {
                this.startPauseBtn.addEventListener('click', () => this.toggleTimer());
                this.resetBtn.addEventListener('click', () => this.resetTimer());
                this.skipBtn.addEventListener('click', () => this.skipPhase());
                
                // Settings inputs
                this.workDurationInput.addEventListener('change', () => this.updateSettings());
                this.shortBreakInput.addEventListener('change', () => this.updateSettings());
                this.longBreakInput.addEventListener('change', () => this.updateSettings());
                
                // Sound toggle
                this.soundToggleBtn.addEventListener('click', () => this.toggleSound());
            }

            toggleTimer() {
                if (this.isRunning) {
                    this.pauseTimer();
                } else {
                    this.startTimer();
                }
            }

            startTimer() {
                this.isRunning = true;
                this.startPauseBtn.textContent = 'Pause';
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateDisplay();
                    this.updateProgress();
                    
                    if (this.timeLeft <= 0) {
                        this.completePhase();
                    }
                }, 1000);
            }

            pauseTimer() {
                this.isRunning = false;
                this.startPauseBtn.textContent = 'Start';
                this.startPauseBtn.classList.remove('pulse-ring');
                clearInterval(this.timer);
            }

            resetTimer() {
                this.pauseTimer();
                this.setPhase('work');
                this.currentSession = 1;
                this.updateDisplay();
                this.updateProgress();
                this.updateSessionDisplay();
            }

            skipPhase() {
                this.pauseTimer();
                this.completePhase();
            }

            completePhase() {
                this.pauseTimer();
                
                // Play sound notification
                this.playDingSound();
                
                if (this.currentPhase === 'work') {
                    this.completedSessions++;
                    this.totalFocusTime += this.getDuration('work');
                    this.updateStats();
                    
                    // Determine next phase
                    if (this.currentSession % 4 === 0) {
                        this.setPhase('longBreak');
                    } else {
                        this.setPhase('shortBreak');
                    }
                } else {
                    // Break completed, move to next work session
                    if (this.currentPhase === 'longBreak') {
                        // Reset cycle after long break
                        this.currentSession = 1;
                    } else {
                        // Continue to next session after short break
                        this.currentSession++;
                    }
                    this.setPhase('work');
                }
                
                this.updateDisplay();
                this.updateProgress();
                this.updateSessionDisplay();
                this.showNotification();
            }

            setPhase(phase) {
                this.currentPhase = phase;
                this.timeLeft = this.getDuration(phase) * 60;
                this.initialTime = this.timeLeft;
                
                const phaseConfig = {
                    work: { icon: 'üíº', text: 'Work Time', label: 'Focus Time' },
                    shortBreak: { icon: '‚òï', text: 'Short Break', label: 'Rest Time' },
                    longBreak: { icon: 'üåü', text: 'Long Break', label: 'Rest Time' }
                };
                
                const config = phaseConfig[phase];
                this.phaseIcon.textContent = config.icon;
                this.phaseText.textContent = config.text;
                this.phaseLabel.textContent = config.label;
            }

            getDuration(phase) {
                switch (phase) {
                    case 'work': return parseInt(this.workDurationInput.value);
                    case 'shortBreak': return parseInt(this.shortBreakInput.value);
                    case 'longBreak': return parseInt(this.longBreakInput.value);
                    default: return 25;
                }
            }

            updateSettings() {
                if (!this.isRunning && this.timeLeft === this.initialTime) {
                    // Only update if timer is not running and hasn't been started
                    this.setPhase(this.currentPhase);
                    this.updateDisplay();
                    this.updateProgress();
                }
            }

            updateDisplay() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                this.timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            updateProgress() {
                const progress = ((this.initialTime - this.timeLeft) / this.initialTime) * 100;
                const circumference = 283; // 2 * œÄ * 45
                const offset = circumference - (progress / 100) * circumference;
                this.progressCircle.style.strokeDashoffset = offset;
                
                // Update session progress based on completed work sessions in current cycle
                const completedWorkSessions = this.currentPhase === 'work' ? this.currentSession - 1 : this.currentSession;
                const sessionProgress = (completedWorkSessions / 4) * 100;
                this.sessionProgress.style.width = `${sessionProgress}%`;
            }

            updateSessionDisplay() {
                this.sessionCounter.textContent = `Session ${this.currentSession} of 4`;
            }

            updateStats() {
                this.completedSessionsEl.textContent = this.completedSessions;
                const hours = Math.floor(this.totalFocusTime / 60);
                const minutes = this.totalFocusTime % 60;
                this.totalTimeEl.textContent = `${hours}h ${minutes}m`;
            }

            updateDateTime() {
                const now = new Date();
                const hktOptions = {
                    timeZone: 'Asia/Hong_Kong',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                };
                
                const weekdayOptions = {
                    timeZone: 'Asia/Hong_Kong',
                    weekday: 'long'
                };
                
                const dateTimeString = now.toLocaleString('en-US', hktOptions);
                const weekdayString = now.toLocaleDateString('en-US', weekdayOptions);
                
                this.currentDateTimeEl.textContent = dateTimeString;
                this.currentWeekdayEl.textContent = weekdayString;
            }

            startDateTimeUpdater() {
                // Update every second
                setInterval(() => {
                    this.updateDateTime();
                }, 1000);
            }

            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                this.updateSoundButton();
            }

            updateSoundButton() {
                if (this.soundEnabled) {
                    this.soundIcon.textContent = 'üîä';
                    this.soundText.textContent = 'Sound On';
                } else {
                    this.soundIcon.textContent = 'üîá';
                    this.soundText.textContent = 'Sound Off';
                }
            }

            playDingSound() {
                if (!this.soundEnabled) return;
                
                // Initialize audio context if needed
                if (!this.audioContext) {
                    try {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (error) {
                        console.log('Audio not supported');
                        return;
                    }
                }
                
                // Resume audio context if suspended (required for some browsers)
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
                
                // Create two "ding" sounds
                this.createDing(0);    // First ding immediately
                setTimeout(() => this.createDing(0), 200);  // Second ding after 200ms
            }

            createDing(delay) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                // Higher frequency for a more noticeable sound
                oscillator.frequency.setValueAtTime(1000, this.audioContext.currentTime + delay);
                oscillator.type = 'sine';
                
                // Create a clear, audible envelope
                const now = this.audioContext.currentTime + delay;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.5, now + 0.01);
                gainNode.gain.linearRampToValueAtTime(0.1, now + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
                
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }



            showNotification() {
                const messages = {
                    work: "Break time! Take a rest üåü",
                    shortBreak: "Back to work! Stay focused üí™",
                    longBreak: "Back to work! You're doing great üöÄ"
                };
                
                const message = messages[this.currentPhase];
                
                // Create custom notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-primary text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                // Animate out and remove
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the timer
        const pomodoroTimer = new PomodoroTimer();
    </script>
</body>
</html>